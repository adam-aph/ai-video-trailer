---
phase: 01-ingestion-pipeline-and-cli-shell
plan: "04"
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.bashrc
  - ~/.bash_profile
autonomous: true
requirements: [CLI-01]
gap_closure: true

must_haves:
  truths:
    - "Running `cinecut --help` succeeds in a non-interactive bash subshell (bash -c 'cinecut --help')"
    - "~/.local/bin is on PATH regardless of whether the shell is interactive or login"
  artifacts:
    - path: "~/.bash_profile"
      provides: "PATH export that runs for login shells and is not guarded by the non-interactive check"
      contains: "export PATH=\"$HOME/.local/bin:$PATH\""
  key_links:
    - from: "~/.bash_profile"
      to: "bash login shell startup"
      via: "bash reads ~/.bash_profile before ~/.bashrc for login shells"
      pattern: "PATH.*\\.local/bin"
---

<objective>
Fix the `cinecut: command not found` error by ensuring ~/.local/bin is on PATH in both interactive and non-interactive shell contexts.

Purpose: The `cinecut` binary installs to `~/.local/bin` via `pip install -e .`. The current ~/.bashrc early-exit guard at line 6 prevents the PATH export at line 124 from being reached in non-interactive shells. This is the only blocker preventing UAT test 1 from passing.

Output: `~/.bash_profile` updated so that `cinecut --help` works in all tested contexts including `bash -c 'cinecut --help'`.
</objective>

<execution_context>
@/home/adamh/.claude/get-shit-done/workflows/execute-plan.md
@/home/adamh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/home/adamh/ai-video-trailer/.planning/PROJECT.md
@/home/adamh/ai-video-trailer/.planning/ROADMAP.md
@/home/adamh/ai-video-trailer/.planning/STATE.md

Gap diagnosed in: /home/adamh/ai-video-trailer/.planning/debug/gap1-cinecut-not-on-path.md

<interfaces>
<!-- Root cause: ~/.bashrc has a non-interactive early-exit guard at line 6:
     case $- in *i*) ;; *) return;; esac
     The PATH export for ~/.local/bin sits at lines 124-125 — AFTER that guard.
     Non-interactive shells (bash -c '...', scripts, exec'd subprocesses) return
     at line 8 and never reach the PATH export.

     ~/.profile adds ~/.local/bin but is only read by login shells and is not
     sufficient for non-login non-interactive shells.

     Fix strategy: Add/update ~/.bash_profile to export ~/.local/bin:$PATH.
     ~/.bash_profile is read by bash LOGIN shells (before ~/.bashrc) and has no
     interactive guard. This covers the most common missing case.

     Additionally, optionally move the PATH line in ~/.bashrc to before the guard
     so non-interactive script subshells also get coverage. -->
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prepend ~/.local/bin to PATH in ~/.bash_profile</name>
  <files>~/.bash_profile</files>
  <action>
    Read ~/.bash_profile (create it if it does not exist). Check if it already
    exports ~/.local/bin in PATH. If not, prepend the following line near the top
    (before any sourcing of ~/.bashrc, so it runs unconditionally):

        export PATH="$HOME/.local/bin:$PATH"

    If ~/.bash_profile already sources ~/.bashrc (common pattern), keep that
    sourcing intact — do not remove it.

    After writing the file, also check ~/.bashrc: if the `export PATH=...local/bin`
    line appears AFTER the `case $-` non-interactive guard (around line 124), move
    it to BEFORE the guard (before line 6). Remove any duplicate copies — only one
    export PATH line for ~/.local/bin should remain in ~/.bashrc.

    Do NOT modify any other lines in ~/.bashrc. The guard itself must stay in place.
  </action>
  <verify>
    bash -c 'source ~/.bash_profile; which cinecut'

    Must print a path ending in ~/.local/bin/cinecut (not "command not found").

    Also verify the file change is syntactically valid:
    bash --norc --noprofile -c 'source ~/.bash_profile; echo PATH OK'
  </verify>
  <done>
    `bash -c 'source ~/.bash_profile; which cinecut'` prints the cinecut path.
    ~/.bash_profile contains `export PATH="$HOME/.local/bin:$PATH"`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify cinecut --help works in a non-interactive subshell</name>
  <files></files>
  <action>
    Run the following verification commands in sequence:

    1. Verify the binary exists at the expected location:
       ls -la ~/.local/bin/cinecut

    2. Run cinecut --help via a bash subshell that sources the profile:
       bash -c 'source ~/.bash_profile && cinecut --help'

    3. Confirm output contains the expected usage text (no traceback):
       The output must mention "--subtitle", "--vibe", and "--review".

    If `cinecut` is not at ~/.local/bin/cinecut (e.g. installed in a venv or
    different prefix), locate the actual installation path with:
       pip show cinecut | grep Location
    and trace it to the scripts directory. Report the actual path in the summary
    but do not change the PATH fix — the pip install location is the expected
    one for `pip install -e .` in editable mode.
  </action>
  <verify>
    bash -c 'source ~/.bash_profile && cinecut --help' 2>&1 | grep -q "\-\-subtitle"
    echo "Exit: $?"

    Must print "Exit: 0".
  </verify>
  <done>
    `bash -c 'source ~/.bash_profile && cinecut --help'` exits 0 and prints
    usage text including --subtitle, --vibe, and --review. No "command not found".
  </done>
</task>

</tasks>

<verification>
After both tasks:

1. `bash -c 'source ~/.bash_profile && cinecut --help'` exits 0 and shows usage
2. `cat ~/.bash_profile | grep local/bin` shows the export PATH line
3. `python -m pytest tests/ -q` — all 33 existing tests still pass (no regressions)
</verification>

<success_criteria>
- `cinecut --help` runs successfully in a bash subshell after sourcing ~/.bash_profile
- ~/.bash_profile contains the PATH export for ~/.local/bin
- ~/.bashrc PATH export (if moved) is now before the non-interactive guard
- All 33 existing unit tests pass
</success_criteria>

<output>
After completion, create `/home/adamh/ai-video-trailer/.planning/phases/01-ingestion-pipeline-and-cli-shell/01-04-SUMMARY.md`
</output>
